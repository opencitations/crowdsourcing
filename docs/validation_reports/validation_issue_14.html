<!DOCTYPE html>
<html lang="eng">
<head>
    <title>Validation output visualiser</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet"/>
    <!-- <link rel="stylesheet" href="style.css"/> -->
    <!-- integrate stylesheet into HTML page via templating -->
    <style>
        .counter-par {
            text-align: center;
            font-size: larger;
        }
        .error-counter {
            font-size: larger;
        }
        table {
            margin: 1em 1em 1em 1em;
            border: 1px solid black;
        }
        th {
            font-style: italic;
        }
        td, th {
            border: 1px solid black; padding: 0.3em;
        }
        .error-icon {
            display: inline-block;
            width: 0.8em;
            height: 0.8em;
            margin-right: 0.1em;
            margin-left: 0.1em;
        }
        .highlight.error span {
            background-color: lightcoral;
        }
        .highlight.warning span {
            background-color: orange;
        }
        .invalid-data.error {
            display: inline-block;
            text-decoration: underline;
            text-decoration-color: LightCoral;
            text-decoration-thickness: 0.1em;
        }
        .invalid-data.warning {
            display: inline-block;
            text-decoration: underline;
            text-decoration-color: Orange;
            text-decoration-thickness: 0.1em;
        }

    </style>
</head>
<body>
    <div class="general-info container-fluid">
        <p class="counter-par"><b>There are <span class="error-counter">2</span> errors/warnings in the table submitted for validation.</b></p>
        <p>The parts of the table that did not validate are marked by an underlining and immediately followed by a coloured square. Data that did not validate is divided into 2 categories: data involved in an Error and data involved in a Warning. An Error prevents the whole row containing it to be processed by the OpenCitations software; a Warning represents the need for the user to manually double-check the interested data, as it is not possible to automatically determine its correctness. Data involving an <span style="background-color: LightCoral">Error</span> is marked by a <span style="text-decoration: underline; text-decoration-color: LightCoral">red underline</span>, data involving a <span style="background-color: orange">Warning</span> is marked by an <span style="text-decoration: underline; text-decoration-color: orange">orange underline</span>.</p>
        <p>Each single coloured square represents the association between an Error/Warning and a single piece of data (immediately preceding it in the document). Squares of the same colour all represent the same error instance. Therefore, an error that involves multiple parts of the table will be represented by as many squares as the number of involved parts.</p>
        <p>To get an explanation of an Error/Warning, hover with the mouse cursor over any of the squares that represent it. If you click on it, all the data involved in the Error/Warning will be highlighted.</p>
    </div>
    <div class="table-container">
        <table id="table-data"><thead><tr><th>row no.</th><th>citing_id</th><th>cited_id</th></tr></thead><tr id="row5"><td><span>5</span></td><td><span class="field-value citing_id"><span class="item"><span class="item-component">doi:10.1007/s42835-022-01029-y</span></span></span></td><td><span class="field-value cited_id"><span class="item err-idx-0 invalid-data error"><span class="item-component">doi:10.1109/tpwrd.2011.2172694</span></span><span class="error error-icon err-idx-0" onclick="highlightInvolvedElements(this)" style="background-color: #6dc984" title="This entity is involved in a citation as either citing or cited entity in CITS-CSV, but no metadata has been provided for it in META-CSV."></span></span></td></tr>
<tr id="row12"><td><span>12</span></td><td><span class="field-value citing_id"><span class="item"><span class="item-component">doi:10.1007/s42835-022-01029-y</span></span></span></td><td><span class="field-value cited_id"><span class="item err-idx-1 invalid-data error"><span class="item-component">doi:10.1016/0021-9991(82)90026-2</span></span><span class="error error-icon err-idx-1" onclick="highlightInvolvedElements(this)" style="background-color: #d4a842" title="This entity is involved in a citation as either citing or cited entity in CITS-CSV, but no metadata has been provided for it in META-CSV."></span></span></td></tr></table>
    </div>
    <script crossorigin="anonymous" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
<!-- <script src="script.js"></script> -->
<!-- integrate JS script into HTML page via templating -->
<script>
    document.addEventListener('click', function(event) {
        const element = event.target;
        const onclickAttr = element.getAttribute('onclick');

        if (!onclickAttr || !onclickAttr.includes('highlightInvolvedElements(this)')) {
            // Remove all highlights globally across all tables
            document.querySelectorAll('.highlight').forEach(el => {
                el.classList.remove('highlight');
            });
        }
    });

    function highlightInvolvedElements(element) {
        const classList = element.className.split(' ');
        const targetClass = classList.find(className => className.startsWith('err-idx-'));
        if (targetClass) {
            // Clear highlights across all tables
            document.querySelectorAll('.highlight').forEach(el => {
                el.classList.remove('highlight');
            });

            // Add highlights only within the same table as the clicked element
            const parentTable = element.closest('table');
            if (parentTable) {
                const elements = parentTable.querySelectorAll('.' + targetClass);
                elements.forEach(el => {
                    el.classList.add('highlight');
                });
            }
        }
    }

</script>
</html>